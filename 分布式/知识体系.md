> 致敬Lamport大师
https://zhuanlan.zhihu.com/p/57372027
https://www.zhihu.com/question/19832447
https://zhuanlan.zhihu.com/p/87157382
《分布式系统设计实践》
《大型网站技术架构：核心原理与案例分析》


### 基础理论
#### 概述
```
1、节点与网络
2、时间与顺序
3、一致性理论
    (1) ACID
        ACID是数据库（DBMS）事务正确执行所必须满足的四个特性
        Atomicity（原子性）、Consistency（一致性）、Isolation（隔离性）、Durability（持久性）
    (2) BASE
        BasicallyAvailable（基本可用）、Soft State（软状态）、Eventual consistent（最终一致性）
    (3) CAP
        CAP理论主张基于网络的数据共享系统，都最多只能拥有以下三条中的两条
        Consistency（一致性）、Available（可用性）、Partition Tolerance (分区容错性)
4、一致性算法
    (1) Paxos
    (2) Raft
```
#### 详细
```
1、ACID
    事务四大特征(ACID)
    (1) 原子性（Atomicity）：事务开始后所有操作，要么全部做完，要么全部不做，不可能停滞在中间环节。事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。也就是说事务是一个不可分割的整体，就像化学中学过的原子，是物质构成的基本单位。
    (2) 一致性（Consistency）：事务开始前和结束后，数据库的完整性约束没有被破坏 。比如A向B转账，不可能A扣了钱，B却没收到。
    (3) 隔离性（Isolation）：同一时间，只允许一个事务请求同一数据，不同的事务之间彼此没有任何干扰。比如A正在从一张银行卡中取钱，在A取钱的过程结束前，B不能向这张卡转账。
    (4) 持久性（Durability）：事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。

2、CAP
    分布式的思想来概括的话，就是CAP。
    在一个分布式系统中，Consistency（一致性）、 Availability（可用性）、Partition tolerance（分区容错性），最多只能同时三个特性中的两个，三者不可兼得。
    (1) Consistency (一致性)
        “all nodes see the same data at the same time”,即更新操作成功并返回客户端后，所有节点在同一时间的数据完全一致，这就是分布式的一致性。一致性的问题在并发系统中不可避免，对于客户端来说，一致性指的是并发访问时更新过的数据如何获取的问题。从服务端来看，则是更新如何复制分布到整个系统，以保证数据最终一致。
    (2) Availability (可用性)
        可用性指“Reads and writes always succeed”，即服务一直可用，而且是正常响应时间。好的可用性主要是指系统能够很好的为用户服务，不出现用户操作失败或者访问超时等用户体验不好的情况。
    (3) Partition Tolerance (分区容错性)
        即分布式系统在遇到某节点或网络分区故障的时候，仍然能够对外提供满足一致性和可用性的服务。分区容错性要求能够使应用虽然是一个分布式系统，而看上去却好像是在一个可以运转正常的整体。比如现在的分布式系统中有某一个或者几个机器宕掉了，其他剩下的机器还能够正常运转满足系统需求，对于用户而言并没有什么体验上的影响。

    CAP三个特性只能满足其中两个，那么取舍的策略就共有三种：
    (1) CA without P
        如果不要求P（不允许分区），则C（强一致性）和A（可用性）是可以保证的。但放弃P的同时也就意味着放弃了系统的扩展性，也就是分布式节点受限，没办法部署子节点，这是违背分布式系统设计的初衷的。
    (2) CP without A
        如果不要求A（可用），相当于每个请求都需要在服务器之间保持强一致，而P（分区）会导致同步时间无限延长(也就是等待数据同步完才能正常访问服务)，一旦发生网络故障或者消息丢失等情况，就要牺牲用户的体验，等待所有数据全部一致了之后再让用户访问系统。设计成CP的系统其实不少，最典型的就是分布式数据库，如Redis、HBase等。对于这些分布式数据库来说，数据的一致性是最基本的要求，因为如果连这个标准都达不到，那么直接采用关系型数据库就好，没必要再浪费资源来部署分布式数据库。
    (3) AP wihtout C
        要高可用并允许分区，则需放弃一致性。一旦分区发生，节点之间可能会失去联系，为了高可用，每个节点只能用本地数据提供服务，而这样会导致全局数据的不一致性。典型的应用就如某米的抢购手机场景，可能前几秒你浏览商品的时候页面提示是有库存的，当你选择完商品准备下单的时候，系统提示你下单失败，商品已售完。这其实就是先在 A（可用性）方面保证系统可以正常的服务，然后在数据的一致性方面做了些牺牲，虽然多少会影响一些用户体验，但也不至于造成用户购物流程的严重阻塞。
```

### 系统分类
```
http://book.mixu.net/distsys/
https://www.zhihu.com/question/23645117

1、分布式存储系统 
    (1) 相关算法
        Paxos, CAP, Consistent Hash, Timing (时钟), 2PC, 3PC
    (2) 分类
        结构化存储
            事务处理系统或者关系型数据库
        非结构化存储 
            分布式文件系统，例如HDFS
            GFS主要思想：master管理、chunks存储并保存多个副本、自动容错恢复
            吞吐率都非常好，适合大文件。无法支持随机访问。
        半结构化存储 
            为了解决结非构化存储系统随机访问性能差的问题
            Nosql、对象存储
            包括Bigtable、Dynamo、HBase
        In-memory 存储
            Redis、memcahed
        NewSQL
            黑科技

2、分布式计算系统
    (1) 相关算法
        MapReduce, 核心就是容错
        传统基于msg的系统 
    (2) 分类     
        MapReduce-like 系统 
        图计算系统
        基于状态（state）的系统 
        Streaming 系统
        
3、分布式管理系统

```

### 场景分类
```
https://zhuanlan.zhihu.com/p/57372027

1、文件系统
    GlusterFS（NAS NFS）、HDFS（hadoop）、ceph（虚机块存储）、swift（restful对象存储）

2、数据库
    也属于文件系统，主数据增加了事务，检索，擦除等高级特性，所以复杂度又增加了，既要考虑数据一致性也得保证足够的性能
    列式存储：Hbase
    文档存储：Elasticsearch，MongoDB
    KV类型：Redis
    关系型：mysql,Spanner

3、计算
    分布式计算系统构建在分布式存储的基础上，充分发挥分布式系统的数据冗余灾备，多副本高效获取数据的特性，进而并行计算，把原本需要长时间计算的任务拆分成多个任务并行处理，从而提高了计算效率
    离线：Hadoop
    实时：Spark
    流式：Storm，Flink/Blink

4、缓存
    提升性能，分布式缓存系统提供了热点数据的随机访问机制，大大了提升了访问时间，但是带来的问题是如何保证数据的一致性，引入分布式锁来解决这个问题
    持久化：Redis
    非持久化：Memcache

5、消息
    分布式消息队列系统是消除异步带来一系列的复杂步骤的一大利器，多线程高并发场景先我们常常要谨慎的去设计业务代码，来保证多线程并发情况下不出现资源竞争导致的死锁问题。而消息队列以一种延迟消费的模式将异步任务都存到队列，然后再逐个消化。
    Kafka
    RabbitMQ
    RocketMQ
    ActiveMQ

6、监控协调
    分布式系统从单机到集群的形态发展，复杂度也大大提高，所以对整个系统的监控也是必不可少
    Zookeeper（paxos的实现）: ZooKeeper 为分布式应用提供了高效可靠的分布式协调服务，提供了统一命名服务、配置管理和分布式锁等分布式的基础服务

7、应用
    分布式系统的核心模块就是在应用如何处理业务逻辑，应用直接的调用依赖于特定的协议来通信，有基于 RPC 协议的，也有基于通用的 HTTP 协议
    HSF
    Dubbo

8、日志
    日志采集：flume
    日志存储：ElasticSearch/Solr，SLS
    日志定位：Zipkin

```

### 模块分类
```
1、分布式系统的前端构造
    (1) Web框架
        MVC
    (2) 反向代理
        Nginx　
    (3) 负载均衡
        DNS负载均衡
        硬件负载均衡
        软件负载均衡

2、分布式中间件
    (1) 分布式同步服务中间件
        一致性协议、ZooKeeper　
    (2)	分布式关系型数据库访问中间件
        MySQL、Cobar
    (3) 分布式服务调用中间件
        Dubbo、gRPC(以及一些rpc高性能框架)
    (3) 分布式消息服务中间件				
        Kafka
    (4) 分布式跟踪服务中间件
        日志 Zipkin

3、分布式存储
    (1) 分布式文件系统
        HDFS、Ceph
    (2) 分布式对象存储
        HDFS+HBase（Base存元数据，利用HDFS的Append功能将小文件合并成大文件）
    (3) 分布式Nosql
        > k-value Nosql
            Redis
        > 列 Nosql
            HBase
        > 文档 Nosql
            Mongodb
        > 图 Nosql
            Neo4j
        > 时间序列 Nosql
            influxDb
        > Newsql


```

### 工程应用
```
1、资源调度
    弹性伸缩：在容器化技术的支撑下，应用扩容，机器下线，机器置换
    网络管理
    故障快照
    现场保留：内存分布，线程数等资源现象的保存
    调试接入：采用字节码技术无需入侵业务代码，可以供生产环境现场日志打点调试

2、流量调度
    负载均衡
    网关设计
    流量管理
        请求校验：非法请求拦截，清洗
        数据缓存：CDN
    流控控制
        真实流量我们采用不同的算法来分流请求
        流量分配
        流量限制：防止系统出现雪崩，预估系统的流量上限，设定阈值

3、服务调度
    流量做好了调度管理后，剩下的就是服务自身的健壮性了

4、数据调度
    状态转移：分离状态至全局存储，请求转换为无状态流量，比如我们通常会将登陆信息缓存至全局redis中间件，而不需要在多个应用中去冗余用户的登陆数据
    分库分表：数据横向扩展
    分片分区：多副本冗余

5、自动化运维
6、容错处理
7、全栈监控
8、故障恢复
9、性能调优
    分布式锁
    高并发
    异步
```

### 分布式基本问题
```
(1) 分布式时钟, 又叫Lamport Clock
(2) 一致性问题，分布式系统的几种一致性，以及具体系统实现上的权衡
(3) 容错性分布式系统的协议以及实现方式，伟大的PAXOS 
```

### 分布式架构
```
https://zhuanlan.zhihu.com/p/74082768

```