### a
```
https://confluence.sensetime.com/pages/viewpage.action?pageId=78090303
http://gitlab.sz.sensetime.com/senseNebula-m
https://confluence.sensetime.com/pages/viewpage.action?pageId=210259293

10.151.116.92  ssh:root/ST#NBL#2018@all  web:admin/Admin123!
10.151.116.99  ssh:root/ST#NBL#2018@all  web:admin/Admin123!
10.151.3.77	   ssh:root/IdeA!#2310@$
10.151.116.152 root/makesense

diaohaiyong@sensetime.com
939791536a-

[nebula-m 项目时间分配] https://confluence.sensetime.com/pages/viewpage.action?pageId=199361563
```

### 计划
```
[go grpc] 
[context] https://draveness.me/golang/
[同步原语] 
[定时器] 
[sync.Map] 
[实现无锁数据结构]
[MQTT]
```

### 草稿
```
.\ROUTE.EXE delete 0.0.0.0
.\ROUTE.EXE add 0.0.0.0 mask  0.0.0.0  10.151.127.254


/usr/share/protoc/bin/protoc -I/home/malx/project/go/pkg/mod -I/home/malx/project/go/pkg/mod/github.com/grpc-ecosystem/grpc-gateway@v1.16.0/ -I/home/malx/project/go/pkg/mod/github.com/grpc-ecosystem/grpc-gateway@v1.16.0/third_party/googleapis/ --go_out=plugins=grpc:. --validate_out=lang=go:.  test.proto

type UnaryClientInterceptor func(ctx context.Context, method string, req, reply interface{}, cc *ClientConn, invoker UnaryInvoker, opts ...CallOption) error
type UnaryServerInterceptor func(ctx context.Context, req interface{}, info *UnaryServerInfo, handler UnaryHandler) (resp interface{}, err error)
```

### 问题
1. Symphony
```
致力于提供云边端协同框架，使得公司云端产品(例如SenseFoundry、SenseSpring等)和边缘产品(SenseUnity、SenseNebula、SensePass、SenseUnity、SenseDLC等)互联互通，通过定义一系列标准云边协议，统一公司内AIoT设备管理，同时提供端边云协同能力（库同步、远程库检索、算法仓应用下发等），实现产品间协同工作
```
2. viper-lite nebula-m
```

```

// 消息传递(req请求 -> res回应)
agent -> route -> cache

faceAgent
	transMsg() {
		someFUnc(){
			REQ:
				reqQueue2Engine_->push()
			RES:
				resQueueFromEngine_->wait_and_pop()
		}
			
	}

faceengine.cpp
	route() {
		queue2engine_->wait_and_pop()
		REQ:
			queue2cache_->push()
		RES:
			queue2agent_["api"]->push()
	}
	
cacheMeseage.cpp
	receiveMessage() {
		receiveQueue_->wait_and_pop()
		sendQueue_->push()
	}


// 重要的queue
Queue2Engine == reqQueue2Engine_(faceAgent.cpp) == sendQueue_(cacheManager.cpp) == queue2engine_(faceengine.cpp)
Queue2Web == resQueueFromEngine_(faceAgent.cpp) == queue2agent_->find(std::string("api"))(faceengine.cpp)
Queue2Cache == receiveQueue_(cacheManager.cpp) == queue2cache_(faceengine.cpp)


// tid 变化
TID_WEB_*** -> TID_NEBULA_Req*** -> TID_NEBULA_ReqCache***

			<- TID_NEBULA_Rsp*** <- TID_NEBULA_RspCache*** 



(0)	FaceAgent::run()
	
(1)	FaceAgent::processMsg()
		while(reqReadyFlag_) {
			transMsg()
			usleep(1)
		}

		transMsg(){
			resReadyFlag_ = true
		}



(2)	FaceAgent::startHttpServer()

		HttpServer.run()
			Server.start()
				(1)	mg_bind
					Server::handleRequest
						controller->handleRequest
							process
								mRoutes[key](request, response)
								[POST:/json]
									reqReadyFlag_ = true
									wait resReadyFlag_

				(2)	processWebCB
				    while(HttpServer::running_)
				    {
			            if(myController_.getReqReadyFlag() && ( comp_num !=0  ))
		                webReqType_.reqUrl     = myController_.getReqUrl();
		                webReqType_.reqMethod  = myController_.getReqMethod();
		                webReqType_.reqMsgId = myController_.getReqMsgId();
		                webReqType_.reqFormPostId = myController_.getReqFormPostId();
		    	        usleep(1);
				    }

				(3)	Server.poll(1000)


// agent
TID_WEB_ALARMIMG_OPTEXPORT_REQ				= 0x400 + 18;  // 1042:  告警图片选择导出
	caseJsonAlarmImageOptExport()
		caseJsonImageOptExport()

// route(faceengine.cpp)
TID_NEBULA_ReqAlarmImageOptionExport
	TID_NEBULA_ReqCacheAlarmImageOptExport

// cache
CacheManager.cpp
	TID_NEBULA_ReqCacheAlarmImageOptExport	0x2700 + 7;
		this->cacheAlarmImageOptExport()